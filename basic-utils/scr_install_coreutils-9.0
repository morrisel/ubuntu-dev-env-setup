#!/bin/bash 

# Сохраняем PID родительского процесса
parent_pid=$$

# Install coreutils-9.0:
# ----------------------
# Advanced Copy – Add Progress Bar To cp And mv Commands In Linux
echo "Downloading and extracting coreutils-9.0"
echo "----------------------------------------"
echo "Step 1."
wget https://ftp.gnu.org/gnu/coreutils/coreutils-9.0.tar.xz
sleep 1

echo "Step 2."
tar xvJf coreutils-9.0.tar.xz
sleep 1

echo "Step 3."
cd coreutils-9.0
sleep 1

echo 'Step 4.'
wget https://raw.githubusercontent.com/jarun/advcpmv/master/advcpmv-0.9-9.0.patch
sleep 1

echo 'Step 5.'
patch -p1 -i advcpmv-0.9-9.0.patch
sleep 1

## Install coreutils-9.0:
## ----------------------
echo "Configure and setting up"
echo "------------------------"
echo "Step 6. Setup and configure after installation"
./configure
make
sleep 1

#
# 7. Now two new patched binaries namely cp and mv will be created in the coreutils-9.0/src folder. Just copy them to yo     ur $PATH like below:
echo "Step 7. Copying new patched cp and mv to /usr/local/bin/ directory"
sudo cp src/cp /usr/local/bin/cp
sudo cp src/mv /usr/local/bin/mv
sleep 1

echo "The installation finished"
echo "coreutils-9.0 configuring"
sleep 1

#echo "How to use"

# That’s it. The cp and mv commands have progress bar functionality now.
# Whenever you want a progress bar while copying or moving files and directories, just add -g flag like below:
#
# $ cp -g archlinux.iso mydownload/
# Or use --progress-bar flag:
# $ cp --progress-bar archlinux.iso mydownload/
# Sample output:
# Copying at  25.7 MiB/s (about 0h 0m 1s remaining)
# archlinux.iso 568.1 MiB / 646.0 MiB
# [=========================================================================> ] 87.9 %
#
# At the end of the copy process, you will see how many files were copied, how long it took to copy the file(s), and the      data transfer rate per second. Nice, isn’t?
# 1 files (646.0 MiB) copied in 11.8 seconds ( 54.7 MiB/s).
#
# To copy a directory and its sub-directories recursively, simply add -R flag:
# $ cp -gR directory1/ directory2/
#
# Similarly, to move files using mv command, run:
# $ mv -g archlinux.iso mydownload/
#
# Or, use --progress-bar flag:
# $ mv --progress-bar archlinux.iso mydownload/
#
# To move directories with mv command, use:
# $ mv -g directory1/ directory2/
#
# 8. You can also create aliases to save a few key strokes. To do so, edit ~/.bashrc file:
# $ nano ~/.bashrc
#    Add the following lines at the end:
#       alias cp='/usr/local/bin/cp -gR'
#       alias mv='/usr/local/bin/mv -g'
# Press Ctrl+o and Ctl+x to save and close the file.
#
# 9. Now run the following command to take effect the changes:
# $ source ~/.bashrc
#
